# This module simulates a photon being fired at the STM detector of choice, and generates a tree with the energy deposited in the detector
# Used to investigate the full energy deposition of the STM detectors
# Original author : Pawel Plesniak
# Note - edit the parameters in this prolog.fcl, aside from the @nil parmaeters

#include "Offline/fcl/minimalMessageService.fcl"
#include "Offline/fcl/standardProducers.fcl"
#include "Offline/fcl/standardServices.fcl"
#include "Offline/STMMC/fcl/prolog.fcl"
#include "Offline/STMReco/fcl/prolog.fcl"

process_name: DetetorEfficiency

source : {
  module_type : EmptyEvent
  maxEvents : 1
}

services : @local::Services.Sim

physics: {
  producers : {
    generate : {
      module_type : PhotonGun
      x : -3990
      y : @local::ComponentPositions.HPGeCrystalEndcapCentre.y
      z : 40637
      E : 1.809
    }
    g4run : @local::g4run
    DigiHPGe : {
      module_type : HPGeWaveformsFromStepPointMCs
      StepPointMCsTag : "g4run:STMDet"
      fADC : @local::STMDAQParameters.samplingFrequencies.HPGe
      EnergyPerADCBin : @local::HPGeDigitization.EnergyPerADCBin
      NoiseSD : @local::HPGeDigitization.PreamplifierNoiseSD
      risingEdgeDecayConstant : @local::HPGeDigitization.DecayConstant
      makeTTree : true
    }
    ZSHPGe : {
      module_type : STMZeroSuppression
      stmWaveformDigisTag : "DigiHPGe:"
      tbefore : @local::STM.HPGe.tbefore
      tafter : @local::STM.HPGe.tafter
      threshold : @local::STM.HPGe.threshold
      window : @local::STM.HPGe.window
      naverage : @local::STM.HPGe.naverage
      verbose : true
    }
    MWDHPGe : {
      module_type : STMMovingWindowDeconvolution
      stmWaveformDigisTag : "ZSHPGe:"
      verbosityLevel : 1
      tau : @local::STM.HPGe.tau
      M : @local::STM.HPGe.M
      L : @local::STM.HPGe.L
      nsigma_cut : @local::STM.HPGe.nsigma_cut
      thresholdgrad : @local::STM.HPGe.thresholdgrad
    }
  }

  p1 : [generate, g4run, DigiHPGe, ZSHPGe] #, MWDHPGe
  trigger_paths : [p1]
}

physics.producers.g4run.physics.physicsListName: "QGSP_BERT_EMZ"
physics.producers.g4run.SDConfig.enableSD: [STMDet]

services.SeedService.baseSeed         : 1323454667 #@nil
services.SeedService.maxUniqueEngines : 1 #@nil
services.TFileService.fileName        : "test.root"
# physics.producers.g4run.debug.trackingVerbosityLevel : 1
# physics.producers.g4run.debug.steppingVerbosityLevel : 1
